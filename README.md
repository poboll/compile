# C语言编译器系统

## 项目概述

本项目是一个编译系统的设计与实现，旨在为一门简化的C语言子集提供完整的编译能力。该项目包含了用C语言实现的一个功能完整的**源到源 (Source-to-Source)** 编译器。

它能够接收C语言子集的代码，并输出经过分析和优化后、功能等效的C代码。本项目完整地实现了编译器的所有核心阶段：词法分析、语法分析、语义分析、代码优化和目标代码生成，是学习和实践编译原理的绝佳案例。

## 主要组件

本编译器包含以下核心组件，均位于 `src/compiler/` 目录：

1.  **词法分析器 (`lexer.c`)**: 将源代码文本转换为Token序列。
2.  **语法分析器 (`parser.c`)**: 将Token序列解析为抽象语法树 (AST)。
3.  **语义分析器 (`analyzer.c`)**: 进行类型检查和变量声明等语义验证。
4.  **代码优化器 (`optimizer.c`)**: 对AST进行优化，例如常量折叠和死代码消除。
5.  **代码生成器 (`codegen.c`)**: 将优化后的AST转换为目标C语言代码。

## 项目结构

```
.
├── Makefile               # C语言版本构建文件
├── package.json           # Node.js项目配置文件
├── README.md              # 项目说明文档
├── c_compiler             # 编译生成的可执行文件
├── output.c               # 编译生成的目标C代码文件
├── src
│   ├── compiler           # C语言编译器核心源码
│   │   ├── analyzer.c
│   │   ├── ast.c
│   │   ├── codegen.c
│   │   ├── common.c
│   │   ├── lexer.c
│   │   ├── optimizer.c
│   │   ├── parser.c
│   │   ├── semantic.c
│   │   ├── symbol.c
│   │   └── token.c
│   │   └── ... (以及对应的.h头文件和JavaScript实现)
│   └── main.c             # C语言编译器主程序入口
└── tests
    ├── test_code.c        # C语言编译器功能测试用例
    └── test_lexer.c       # C语言词法分析器测试用例
```

## 功能与特性

- **模块化设计**: 编译器各阶段（词法、语法等）分离，逻辑清晰。
- **详细的编译过程输出**: 运行时清晰地展示编译过程的每个阶段，便于调试和理解。
- **代码优化**: 实现了基础的代码优化，如常量折叠和无效分支消除。
- **C到C的转换**: 将输入的C代码转换为功能相同但可能更高效的C代码。
- **错误处理**: 包含基本的语义错误检查机制。

## 如何构建与运行 (C语言版本)

确保你已经安装了 `gcc` 和 `make`。

### 1. 编译项目

在项目根目录运行 `make` 命令，这将编译所有源文件并生成一个名为 `c_compiler` 的可执行文件。

```bash
make
```

### 2. 运行编译器

`make` 提供了一个方便的测试命令，它会使用生成的 `c_compiler` 去编译 `tests/test_code.c` 文件，并显示结果。

```bash
make test
```

该命令会：
1.  运行编译器，处理 `tests/test_code.c`。
2.  将生成的优化后C代码保存在 `output.c`。
3.  编译并运行 `output.c`，展示最终的执行结果。

你也可以手动运行编译器来处理你自己的文件：

```bash
./c_compiler your_source_file.c
```

### 3. 清理构建文件

要删除所有编译生成的目标文件 (`.o`) 和可执行文件，请运行：

```bash
make clean
```

## 支持的语言特性 (C语言子集)

当前编译器主要支持以下特性：
- 全局和局部 `int` 类型变量声明与赋值
- 包含 `+`, `>`, `()` 的算术和关系表达式
- `if-else` 条件语句
- `main` 函数作为程序入口
- 调用 `printf` 等函数（无参数类型检查）

## 编译过程

1.  **词法分析**: 将源代码分解为标记 (tokens)。
2.  **语法分析**: 根据语言语法构建抽象语法树 (AST)。
3.  **语义分析**: 检查变量作用域等。
4.  **代码优化**: 对AST进行优化，提高程序执行效率。
5.  **代码生成**: 将优化后的AST转换为目标C代码。

## 未来计划

- 支持更多C语言特性，如循环 (`for`, `while`)、更多数据类型 (`float`, `char`)、数组和指针。
- 实现更多高级优化技术。
- 完善错误报告和恢复系统。

## 许可证

MIT许可证